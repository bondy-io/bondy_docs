# Configuration Basics
> Learn about the Bondy runtime configuration, the Bondy configuration file, its syntax, variable replacement and the required OS-specific configuration.{.definition}

The complete behaviour of Bondy is the combination of 3 types of configuration:

1. **Bondy node runtime configuration**, which controls things like network listeners, availability of optional services, security defaults, clustering and load regulation.
1. **Multi-tenancy security configuration**, which controls the definition of realms and its security including user identities, authentication and authorizacion policies, Same Sign-on and Single Sign-on.
1. **Service and Topic Registry configuration**, which defines the available RPC procedures–their invocation policies e.g. load balancing, and the identity and location of its implementing instance (Callees)–and PubSub subscriptions.

The following diagram shows the scopes and mechanism for managing each the 3 types:

1. **Bondy node runtime configuration**—This is mostly static configuration done via the `bondy.conf` file. However, some parameters can be altered dynamically via the Admin API.
1. **Multi-tenancy security configuration**—This is dynamically configured via the Admin API. However, it can also be configured via the `bondy.conf` file.
1. **Service and Topic Registry configuration**—This is dynamic configured by clients and maintained in the `Registry`.

<ZoomImg src="/assets/configuration_scopes.png"/>

::: info Documentation Scope
This refence document covers only the first type i.e. **Bondy node runtime configuration**.

To learn more about **Multi-tenancy security configuration** check the [WAMP](/reference/wamp_api) and [HTTP](/reference/http_api) references.

**Service and Topic Registry configuration** is entirely managed by clients using [WAMP](/concepts/what_is_wamp).
:::

## The `bondy.conf` file
Bondy configuration file is used to set a wide variety of **node runtime configuration options**.

During the node startup, Bondy will check the existance of the file, parse it and validate its contents. In case of a syntax or validation error, Bondy will crash printing the reason to standard output.

If a configuration file is not found at the [expected location](#file-location), Bondy will create one using default values.

:::tip
Start a Bondy node without providing a configuration file and inspect the one generated by Bondy once the node has started. You can use this file as a template to make your modifications. Then copy your modified file to the [expected location](#file-location) and start Bondy again.
:::

### File Location
The file location depends on the installation method you've used as shown in the following table.

|Installation method|Location|
|:---|:---|
|Source tarball|`/etc/bondy.conf`|
|Docker image|`/bondy/etc/bondy.conf`|


### File Syntax
The file uses a sysctl-like syntax that looks like this:

```text
# comment
token = value
```

Note that blank lines are ignored, and whitespace before and after a token or value is ignored, although a value can contain whitespace within.  Lines which begin with a `#` are considered comments and ignored.

The documentation for each token defines the acceptable datatype and format for each value and the default value.

#### Datatypes

The following are the set of acceptable datatypes used in the documentation.

|Type|Description|Example|
|---|---|---|
|`string()`|Any string. Although each token might add specific formatting rules via the documentation| `100`|
|`integer()`|An integer| `100`|
|`bytesize()`|Work pretty much like duration but with three differences.<br>The units are `MB`, `KB` and `GB`<br>If not unit is specified, the value defaults to bytes<br>You can only use one unit.<br> Lowercase units (i.e. `gb`, `mb`, and `kb`) are ok, but mixed case are not. That's to avoid confusion with Megabits|`1KB`|
|`flag()`|Equivalent of a boolean value| `on` \| `off`|
|`time_duration_units()`|Durations are fixed intervals of time, the largest unit of which will be a one week. Anything larger will have to be expressed in terms of weeks, since larger units (month, year) are of variable duration. The following units are supported:<br>- `f`: fortnight<br>- `w`: week<br>- `d`: day<br>- `h`: hour<br>- `m`: minute<br>- `s`: second<br>- `ms`: millisecond<br>You can use any combination of these. | `1w2d`|


#### Example

<tabs cache-lifetime="1000" class="code">
<tab name="bondy.conf">

```text
nodename = bondy@127.0.0.1
distributed_cookie = bondy
security.allow_anonymous_user = off
```
</tab>
</tabs>



::: warning Default values
Notice that for every option not provided by your configuration, Bondy will define a default value (check the default value for each of the Configuration Reference sections).

Take the following snippet of the [Node section](/reference/configuration/node.html#node-identity) as an example.

@[config](nodename,string,'bondy@127.0.0.1',v0.1.0)

<br>It defines the token `nodename` which takes a `string` value and defaults to `bondy@127.0.0.1`. Notice the documentation will further specify which strings are acceptable.

:::



## Variable replacement

Within the `bondy.conf` file you can use the following variables which Bondy will substitute before running.

- `platform_etc_dir`

The following is an example of how to use variable substitution.

```
broker_bridge.config_file = $(platform_etc_dir)/broker_bridge_config.json
```

::: warning Notice
These mechanism cannot be used to do OS environment variables substitution.
However, Bondy provides a tool for OS variable substitution that is automatically used by the start script.
:::

### Feature-specific configuration files

Some features and/or subsystems in Bondy allow providing an additional JSON configuration file e.g. the Security subsystem.

In those cases, we need to let Bondy know where to find those specific files. This is done in the `bondy.conf` under the desired section e.g. the following configuration file adds the location for the `security_conf.json` file.

```
nodename = bondy@127.0.0.1
distributed_cookie = bondy
security.allow_anonymous_user = off
security.config_file = /bondy/etc/security_conf.json
```

## Environment variables

## Operating System Configuration

### Configuring Open File Limits‌

Bondy can accumulate a large number of open file handles during operation. The creation of numerous data files is normal, and the storage backend performs periodic merges of data file collections to avoid accumulating file handles.

To accommodate this you should increase the open files limit on your system. We recommend setting a soft limit of `65536`` and a hard limit of `200000``.

Most operating systems can check and change the open-files limit for the current shell session using the `ulimit`command.

Start by checking the current open file limit values with:

```bash
ulimit -Hn # Hard limit
ulimit -Sn # Soft limit
```

Set the limit by using:

```bash
ulimit -n 200000
```

This configuration persists only for the duration of your shell session. To change the limit on a system-wide, permanent basis read the following sections.

::: details Open file limits on Linux
On most Linux distributions, the total limit for open files is controlled by `sysctl`.

If you installed Bondy from a binary package, you will need to the add the following settings to the `/etc/security/limits.conf` file for the `bondy` user:

```bash
bondy soft nofile 65536
bondy hard nofile 200000
```
:::


::: details Open file limits on Debian and Ubuntu using PAM

You can enable PAM-based user limits so that non-root users, such as the `bondy` user, may specify a higher value for maximum open files.

Edit `/etc/pam.d/common-session` and add the following line:

```bash
session required pam_limits.so
```

Save and close the file.
If `/etc/pam.d/common-session-noninteractive` exists, append the same line as above.

Then, edit `/etc/security/limits.conf` and append the following lines to the file:

```bash
soft nofile 65536
hard nofile 200000
```

Save and close the file.

(Optional) If you will be accessing the Bondy nodes via secure shell (SSH), you should also edit `/etc/ssh/sshd_config` and set the following line:

```
UseLogin yes
```

‌

Restart the machine so the limits take effect and verify that the new limits are set with the following command:

```bash
ulimit -a
```
:::

::: details Open file limits on Docker running on K8s
Docker ulimits limit a program's resource utilization to prevent a run-away bug or security breach from bringing the whole system down.

The instructions below describe how to check what your current value is, and then increase it to allow Bondy to run.

**To increase the ulimit value:**

1. Connect to the desired worker node and execute the following command:

```bash
systemctl show docker
```

1. Search for NOFILE.
2. If the output is “1024”, edit the file:

```bash
/etc/sysconfig/docker
```

and replace the line:

```bash
OPTIONS=" — default-ulimit nofile=1024:4096"
```

with:

```bash
OPTIONS="--default-ulimit nofile=2000000:2000000"
```

1. Restart the Docker daemon

```bash
sudo systemctl restart docker
```
:::

::: details Open file limits on DockerUser
Use docker run `--ulimit`

```bash
$ docker run --ulimit nofile=2000000:2000000
```
:::